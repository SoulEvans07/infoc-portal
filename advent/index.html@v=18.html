<!DOCTYPE html>
<html lang="hu">

<head>
<meta charset="utf-8">
<title>TEST InfoC :: Adventi naptár</title>
<meta property="og:title" content="TEST InfoC :: Adventi naptár">
<meta property="og:image" content="/modulz/logo.png">
<meta property="og:description" content="TEST InfoC :: Adventi naptár">
<meta property="og:site_name" content="InfoC – Programozás alapjai I.">
<meta name="description" content="TEST InfoC :: Adventi naptár">
<meta name="robots" content="noarchive">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="../modulz/favicon.ico" id="faviconhref">
<link rel="apple-touch-icon" href="../modulz/logo_touch.png">
<link rel="image_src" href="../modulz/logo.png"> 
<link rel="stylesheet" href="../modulz/alap-infoc.css@v101.css">
<link rel="stylesheet" href="../modulz/style/localfonts.css@v101.css">
<script>var infoc = { onloads: [] };</script>
<script src="../modulz/site.js@v101"></script>
</head>

<body class=" doksi-formatum" data-version="101"
    data-halozati-hiba="Hálózati hiba a kérés teljesítése közben."
    data-tul-nagy-keres="A fájl túl nagy!"
    data-biztos-navigal="Biztos el szeretnél navigálni? A nem mentett változások elvesznek."
    data-ird-be-a-keresoszot="Írd be a keresőszót!"
    data-vissza="Vissza">

<div class="bodycontent">

<nav class="menubg clearfix">
<div class="shaper">
<div id="menu" class="menu menu-font-size">
<a id="menu-nyito" class="menu-nyito"  role="button"><i class="hamburger"></i></a>
<div class="menu-brand"><a href="../index/index.html">InfoC</a></div>
<div id="menu-elemek" class="menu-elemek">
<ul>
<li class="almenu "><a>Infó</a>
<ul>
<li><a  href="../index/index.html">Kezdőlap</a>
<li><a  href="../elerhetoseg/index.html">Elérhetőség</a>
</ul>

<li class="almenu "><a>Tananyag</a>
<ul>
<li class="almenu "><a>Előadás</a>
<ul>
<li><a  href="../ea01/index.html">1. hét: típusok, változók, vezérlés</a>
<li><a  href="../ea02/index.html">2. hét: nevezetes algoritmusok, tömbök</a>
<li><a  href="../ea03/index.html">3. hét: függvények, struktúrák</a>
<li><a  href="../ea04/index.html">4. hét: pointerek, sztringek</a>
<li><a  href="../ea05/index.html">5. hét: rendezések, rekurzió</a>
<li><a  href="../ea06/index.html">6. hét: operátorok, számábrázolás</a>
<li><a  href="../ea07/index.html">7. hét: dinamikus memóriakezelés</a>
<li><a  href="../ea08/index.html">8. hét: fájlkezelés, modulok</a>
<li><a  href="../ea10/index.html">10. hét: láncolt listák</a>
<li><a  href="../ea11/index.html">11. hét: bináris fák</a>
<li><a  href="../ea12/index.html">12. hét: állapotgépek, reguláris kifejezések</a>
<li><a  href="../ea13/index.html">13. hét: generikus algoritmusok, visszalépő keresés</a>
<li><a  href="../ea14/index.html">14. hét: összefoglalás</a>
</ul>

<li class="almenu "><a>Labor</a>
<ul>
<li><a  href="../lab01/index.html">1. hét: parancssor, ZIP</a>
<li><a  href="../lab02/index.html">2. hét: egyszerű programok</a>
<li><a  href="../lab03/index.html">3. hét: tömbök, nevezetes algoritmusok</a>
<li><a  href="../lab04/index.html">4. hét: struktúrák és függvények</a>
<li><a  href="../lab06/index.html">6. hét: pointerek, sztringek</a>
<li><a  href="../lab07/index.html">7. hét: rekurzió</a>
<li><a  href="../lab08/index.html">8. hét: dinamikus tömbök I.</a>
<li><a  href="../lab09/index.html">9. hét: dinamikus tömbök II.</a>
<li><a  href="../lab10/index.html">10. hét: láncolt listák</a>
<li><a  href="../lab11/index.html">11. hét: bináris fák</a>
<li><a  href="../lab12/index.html">12. hét: gyakorlás NZH-ra</a>
<li><a  href="../lab13/index.html">13. hét: állapotgépek</a>
<li><a  href="../lab14/index.html">14. hét: labirintus játék</a>
</ul>

<li class="almenu "><a>Gyakorlat</a>
<ul>
<li><a  href="../gy01/index.html">1. hét: adatmodellezés, algoritmusok</a>
<li><a  href="../gy02/index.html">2. hét: tanult algoritmusok</a>
<li><a  href="../gy03/index.html">3. hét: egyszerű programok</a>
<li><a  href="../gy04/index.html">4. hét: tételek és tömbök</a>
<li><a  href="../gy05/index.html">5. hét: származtatott típusok</a>
<li><a  href="../gy06/index.html">6. hét: karakterek, számrendszerek</a>
<li><a  href="../gy07/index.html">7. hét: pointerek használata</a>
<li><a  href="../gy08/index.html">8. hét: rekurzió</a>
<li><a  href="../gy09/index.html">9. hét: dinamikus tömbök</a>
<li><a  href="../gy10/index.html">10. hét: láncolt listák</a>
<li><a  href="../gy12/index.html">12. hét: bináris fák</a>
<li><a  href="../gy13/index.html">13. hét: állapotgépek</a>
<li><a  href="../gy14/index.html">14. hét: generikus algoritmusok</a>
</ul>

<li class="almenu "><a>Példatár</a>
<ul>
<li><a  href="../f01/index.html">1. hét: egyszerű programok</a>
<li><a  href="../f02/index.html">2. hét: logika, sorozatok, tömbök</a>
<li><a  href="../f03/index.html">3. hét: függvények, struktúrák</a>
<li><a  href="../f04/index.html">4. hét: pointerek, sztringek</a>
<li><a  href="../f05/index.html">5. hét: rendezések, rekurzió</a>
<li><a  href="../f06/index.html">6. hét: számábrázolás, bitek</a>
<li><a  href="../f07/index.html">7. hét: dinamikus memóriakezelés</a>
<li><a  href="../f08/index.html">8. hét: parancssor, fájlkezelés, modulok</a>
<li><a  href="../f10/index.html">10. hét: láncolt listák</a>
<li><a  href="../f11/index.html">11. hét: bináris fák, többszörös indirekció</a>
<li><a  href="../f12/index.html">12. hét: állapotgépek</a>
<li><a  href="../f13/index.html">13. hét: generikus algoritmusok</a>
</ul>

<li><a  href="../nhflista/index.html">Nagy házi lista</a>
</ul>

<li class="almenu "><a>Segédlet</a>
<ul>
<li><a  href="../jegyzet/index.html">Jegyzet és puska</a>
<li><a  href="../fejlesztokornyezet.html">Fejlesztőkörnyezetek</a>
<li><a  href="../stilus/index.html">Kódolási stílus</a>
<li><a  href="../for_vs_while/index.html">For vagy while?</a>
<li class="almenu "><a>Nagy házi</a>
<ul>
<li><a  href="../mintanhf/index.html">Minta nagy házi</a>
<li><a  href="../nhfspecifikacio/index.html">Specifikáció: hogyan?</a>
<li><a  href="../debugmalloc/index.html">Debugmalloc, memóriakezelés</a>
<li><a  href="../fajlkezeles/index.html">Fájlkezelés, mappák</a>
<li><a  href="../megjelenites/index.html">Szöveges és grafikus megjelenítés</a>
<li><a  href="../scanf/index.html">Scanf problémák</a>
<li><a  href="../scanf_hibakezeles/index.html">Scanf és hibakezelés</a>
<li><a  href="../karakterkodolas/index.html">Karakterkódolások</a>
<li><a  href="../cbtobbmodul/index.html">Több modulos programok</a>
</ul>

<li class="almenu "><a>ZH</a>
<ul>
<li><a  href="../tldr1/index.html">TL;DR I.</a>
<li><a  href="../tldr2/index.html">TL;DR II.</a>
</ul>

</ul>

<li class="almenu "><a>Extrák</a>
<ul>
<li class="almenu "><a>SVG óra galéria</a>
<ul>
<li><a  href="../orak2021/index.html">SVG óra galéria 2021</a>
<li><a  href="../orak2020/index.html">SVG óra galéria 2020</a>
<li><a  href="../orak2019/index.html">SVG óra galéria 2019</a>
<li><a  href="../orak2018/index.html">SVG óra galéria 2018</a>
<li><a  href="../orak2017/index.html">SVG óra galéria 2017</a>
<li><a  href="../orak2016/index.html">SVG óra galéria 2016</a>
<li><a  href="../orak2015/index.html">SVG óra galéria 2015</a>
</ul>

<li class="almenu "><a>NHF galéria</a>
<ul>
<li><a  href="../nhfgaleria2021/index.html">NHF galéria 2021</a>
<li><a  href="../nhfgaleria2020/index.html">NHF galéria 2020</a>
<li><a  href="../nhfgaleria2019/index.html">NHF galéria 2019</a>
<li><a  href="../nhfgaleria2018/index.html">NHF galéria 2018</a>
<li><a  href="../nhfgaleria2017/index.html">NHF galéria 2017</a>
<li><a  href="../nhfgaleria2016/index.html">NHF galéria 2016</a>
<li><a  href="../nhfgaleria2015/index.html">NHF galéria 2015</a>
<li><a  href="../nhfgaleria2014/index.html">NHF galéria 2014</a>
<li><a  href="../nhfgaleria2013/index.html">NHF galéria 2013</a>
<li><a  href="../nhfgaleria2012/index.html">NHF galéria 2012</a>
</ul>

<li class="almenu "><a>Elmélet</a>
<ul>
<li><a  href="../turing/index.html">Mit tud a számítógép?</a>
<li><a  href="../bf/index.html">BF</a>
<li><a  href="../bitturmix/index.html">Bitturmix</a>
<li><a  href="../kifesto/index.html">Zárt terület kifestése</a>
<li><a  href="../labirintus/index.html">Labirintusok</a>
<li><a  href="../qsort/index.html">Gyorsrendezés</a>
<li><a  href="../tripla/index.html">Tripla indirekció</a>
<li><a  href="../generikus/index.html">Generikus lista</a>
</ul>

<li class="almenu "><a>Gyakorlat</a>
<ul>
<li><a  href="../strlcpy/index.html">Kulturált sztringmásoló</a>
<li><a  href="../xor_csere/index.html">XOR csere</a>
<li><a  href="../include/index.html">include</a>
<li><a  href="../inline/index.html">inline</a>
<li><a  href="../internet/index.html">Internet</a>
</ul>

<li class="almenu "><a>Grafika</a>
<ul>
<li><a  href="../sdl/index.html">SDL grafika</a>
<li><a  href="../sdl_telepito/index.html">SDL telepítés</a>
<li><a  href="../fa/index.html">Fák rajzolása</a>
</ul>

<li class="almenu "><a>Nyelvészet</a>
<ul>
<li><a  href="../mondatelemzo/index.html">Mondatelemző</a>
<li><a  href="../kifejezesek/index.html">Kifejezések</a>
<li><a  href="../derivalas/index.html">Deriválás</a>
</ul>

<li><a  href="index.html">Adventi naptár</a>
</ul>

</ul>
</div>
</div>
</div>
</nav>

<div class="menu-font-size"><div class="menuplaceholder"></div></div>

<main class="doksi">
<div class="shaper">


<section class="slidescreen" data-title="Adventi naptár">
<div class="slide" id="slide_0">

<a id="0" class="namer"></a>


<div class="slidecontent">
  <div class="float" style="margin-top: 0.25em; margin-bottom: 0;"><button type="button" class="vissza" onclick="history.back();">Vissza</button></div>
<h1 class="eloadascim">Adventi naptár</h1>
<div class="focim">
<p class="szerzocim"><i class="szerzo"></i> Czirkos Zoltán · <i class="ido"></i> 2019.02.27.</p>
<p class="kivonat"></p>
</div>
<h2>Háromdimenziós grafika – forgatás és perspektíva</h2>

<img src="advent18-kocka.png" class="float">

<p>Eddig az összes grafikus program az adventi naptárban kétdimenziós grafikával dolgozott.
Minden kirajzolt dolog egy síkon volt, a monitor síkján. A repülős játéknál kicsit foglalkozni
kellett a magasságokkal (hogy ne úgy rajzolja ki a program a repülőket, mintha a fák alatt
mennének el), de a repülők abban sem térben mozogtak – nem tároltuk el igazából azok magasságát.

<p>Három dimenzióban viszont ezt megtesszük. Itt minden tárgynak három koordinátája van,
<code>x</code>, <code>y</code>, és <code>z</code>. Viszont a monitorunk továbbra is kétdimenziós, úgyhogy a
látott képet valahogy ki kell lapítani, leképezni azt a monitor síkjára, pontosan úgy, mint amikor
egy fényképet készítünk. Ehhez nem elég simán csak eldobni a <code>z</code>, mélység koordinátát, hanem
valamiféle számításokat kell végezni. Minél messzebb van egy tárgy, annál kisebbnek kell látszódjon.
Az ehhez tartozó számítás, amelynek neve vetítés (perspektivikus leképezés), meglepően egyszerű.

<p>A mai program nem lesz OpenGL-es, és a 3D kirajzolást nem a grafikus kártya fogja elvégezni,
hanem maradunk az SDL-nél, és a „kézzel” számolásnál. Így látszani fog, mi hogyan történik. A
végeredmény: egy program, amely szabályos testeket rajzol ki és forgat – vagyis inkább bármit,
mivel a kirajzolt testek adatait fájlból olvassa be.





  
        <nav id="tartalom">
      <h3>Tartalom</h3>
      <ol>              <li><a href="index.html@v=18.html#1" class="">A vetítés matematikája</a>
              <li><a href="index.html@v=18.html#2" class="">A forgatás matematikája</a>
              <li><a href="index.html@v=18.html#3" class="">Az adatszerkezet</a>
              <li><a href="index.html@v=18.html#4" class="">A program működése</a>
            </ol>    </nav>
  </div>

<div class="clear"></div>

</div>
</section>


<section class="slidescreen" data-title="A vetítés matematikája">
<div class="slide" id="slide_1">

<a id="1" class="namer"></a>

<div class="slideheader">
  <h2 class="slidetitle">
    <span class="oldalszam">1</span><span class="oldalszamafter">. </span>    A vetítés matematikája<a class="hlink" href="index.html@v=18.html#1"><i class="hlink"></i></a>
  </h2>
</div>

<div class="slidecontent">
  
<p>A programban a függvénykirajzolóhoz hasonlóan két koordinátarendszert fogunk használni. A
képernyő koordinátarendszerének origója a monitor bal felső sarka, és az <code>x</code> tengely jobbra
mutat, az <code>y</code> pedig lefelé. A térbeli koordinátarendszer origója ezzel szemben középen van;
az <code>x</code> irány a vízszintes, és jobbra nő, az <code>y</code> a függőleges, és felfelé nő, a <code>z</code>
tengely pedig a mélységet jelenti. Leképezéskor ez átdöfi a monitot. A nagyobb <code>z</code>
koordinátájú tárgyak távolabb vannak.

<p>Az első és legfontosabb kérdés az, hogyan lesz a háromdimenziós  koordinátákból kétdimenziós
képkoordináta. Ez a leképezés meglepően egyszerű.

<img src="advent18-persp.svg" style="width: 42em;" class="kozep">

<p>Ezen a rajzon a P(x;y;z) pont van a háromdimenziós térben; ennek a helyét, P'(x';y')-t
keressük a vetítési síkon (monitoron :)). A monitor a <code>z=0</code> síknak felel meg, amit most
oldalról nézzük, és egybeesik a rajzon az <code>y</code> tengellyel. A néző a kép bal szélén van, az M
pontban, <code>d</code> távolságra a monitortól. A P' pont helyét a P és M pontok közötti szakasz és a
sík metszete határozza meg. Ezt a szakaszt berajzolva a metszéspontonkívül kapunk két hasonló,
derékszökű háromszöget. Ezen derékszögű háromszögek befogói <code>d</code> és <code>y'</code>, továbbá
<code>d+z</code> és <code>y</code>. A hasonlóság miatt a <code>d/y'=(d+z)/y</code> egyenletet írhatjuk fel. Ebből
<code>y'</code>-t kifejezve <code>y'=d&middot;y/(d+z)</code> adódik – és már kész is vagyunk. A vetítés
lényegében egy osztásból áll, ami szemlélet szerint helyes is: minél távolabb van valami, annál kisebb lesz.
Az <code>x'</code> koordináta ugyanígy számítható:

<pre   ><code class="language-c">xk = +d * x/(z + d) + screen-&gt;w/2;
yk = -d * y/(z + d) + screen-&gt;h/2;</code></pre>

<p>Az <code>yk</code> -1-es szorzója azért kell, mert eltérő a függőleges tengelyek iránya a
térben és a monitoron, a <code>w/2</code> és a <code>h/2</code> pedig a képernyő közepét adják.

<p>A programban a forgatott testek az origó körül lesznek, mivel az 
akörüli forgatást könnyű leírni matematikailag. A vetítési sík pedig 
a <code>z=0</code> sík, ahogy a rajzon is – tehát az origó helye a 
monitor közepe. A <code>d</code> távolsággal azt adjuk meg, hogy 
milyen messze vagyunk ettől a vetítési síktól. Nagy távolság esetén 
nem nagyon számít a vetített pontok eredeti <code>z</code> 
koordinátája a hányadosban hozzáadott nagy <code>d</code> miatt. Ha 
közel megyünk a síkhoz, akkor viszont <code>d</code> kicsi, és a 
pontok vetített helyzetét erősen befolyásolja a <code>z</code> 
koordinátájuk. Az alábbi rajzok egy 200 egység oldalhosszúságú kockát
mutatnak különböző távolságokból:

<div class="columns">
    <div>
        <img src="advent18-kocka300.png" class="kozep">
        <p class="kozep">d = 300</p>
    </div>
    <div>
        <img src="advent18-kocka600.png" class="kozep">
        <p class="kozep">d = 600</p>
    </div>
    <div>
        <img src="advent18-kocka1200.png" class="kozep">
        <p class="kozep">d = 1200</p>
    </div>
</div>

<p>Az első rajzon annyira közel van a kocka a szemünkhöz, hogy az első lapja elfed minden
mást; a harmadik rajzon pedig olyan távol, hogy a leképezésen már majdnem teljesen párhuzamosak
azok a vonalak, amelyek térben is azok. Az elsőn szinte kiböki a szemünket, a harmadikon
meg messziről nézzük, távcsővel.</p>





  
    </div>

<div class="clear"></div>

</div>
</section>


<section class="slidescreen" data-title="A forgatás matematikája">
<div class="slide" id="slide_2">

<a id="2" class="namer"></a>

<div class="slideheader">
  <h2 class="slidetitle">
    <span class="oldalszam">2</span><span class="oldalszamafter">. </span>    A forgatás matematikája<a class="hlink" href="index.html@v=18.html#2"><i class="hlink"></i></a>
  </h2>
</div>

<div class="slidecontent">
  
<img src="advent18-forgat.svg" class="float" style="width: 11em;">

<p>Forgassunk el egy P(x;y) pontot az origó körül! Ha a forgatás szöge β, akkor az alábbi
egyenleteket írhatjuk fel (α és r a pont eredeti helyzetét határozzák meg):

<pre style="width: auto; overflow: auto;">
x  = r·cosα        y  = r·sinα
x' = r·cos(α+β)    y' = r·sin(α+β)
</pre>

<p>Behelyettesítve <code>cos(α+β)</code>-t és <code>sin(α+β)</code>-t az ismert összefüggések alapján:

<pre style="width: auto; overflow: auto;">
x' = r·(cosα·cosβ-sinα·sinβ) = r·cosα·cosβ-r·sinα·sinβ = x·cosβ - y·sinβ
y' = r·(sinα·cosβ+cosα·sinβ) = r·sinα·cosβ+r·cosα·sinβ = x·sinβ + y·cosβ
</pre>

<p>Vagyis az elforgatott pont koordinátái könnyen kifejezhetők az eredeti koordinátákból és
a forgatás szögének megfelelő <code>sinβ</code>, <code>cosβ</code> függvényértékekből. Egy
síkon ez az egyetlen egy fajta forgatás lehetséges, a térben viszont többféle, mert forgathatunk
mind a három tengely körül. A <code>z</code> tengely körüli forgatást éppen a fenti képlet írja le,
mert olyankor <code>z'=z</code>. Az <code>x</code> és az <code>y</code> tengely körüli forgatásnál rendre az
<code>x</code> és <code>y</code> koordináták maradnak változatlanul, míg a másik kettő a fenti képlethez
hasonlóan számolható. A három tengely körüli forgatást billentésnek (pitch), fordulásnak (yaw)
és csavarásnak (roll) is szoktuk nevezni.

<p>A térben forgatásnál egy dologra kell figyelni, nevezetesen arra, hogy a három forgatás
sorrendje számít: nem mindegy, hogy valamit előbb az <code>x</code>, utána az <code>y</code> tengely körül
forgatunk el, vagy fordítva. Ezt mindenki könnyedén kipróbálhatja magának egy dobókockával.


  
    </div>

<div class="clear"></div>

</div>
</section>


<section class="slidescreen" data-title="Az adatszerkezet">
<div class="slide" id="slide_3">

<a id="3" class="namer"></a>

<div class="slideheader">
  <h2 class="slidetitle">
    <span class="oldalszam">3</span><span class="oldalszamafter">. </span>    Az adatszerkezet<a class="hlink" href="index.html@v=18.html#3"><i class="hlink"></i></a>
  </h2>
</div>

<div class="slidecontent">
  
<img src="advent18-ikoza.png" class="float">

<p>Eljött a programozás ideje. Jobb oldalt egy ikozaéder látható. Ennek a térbeli
koordinátáit kellene tárolnunk; ezt kellene forgatnunk és kirajzolnunk a képernyőre.

<p>Van egy nagyon fontos megfigyelés, amit tehetünk itt, mégpedig az, hogy ennek minden csúcsából
öt él indul ki. Ezt általánosságban is megfigyelhetjük, hogy bármelyik poliédernek (sík lapokkal
határolt testnek) minden csúcsából legalább három él indul ki. Ha a jobb oldalihoz hasonló drótvázat
kell kirajzolni, azaz az éleket, akkor nem érdemes minden élhez eltárolni azok koordinátáit.
Ha így tennénk, akkor egy ikozaéder esetén minden csúcson ötször végeznénk el a forgatást és
a vetítést. Érdemes tehát a csúcsokat külön eltárolni, és az éleknél pedig csak azt az információt
rögzíteni, hogy melyik két csúcsot köti össze.

<p>Definiáljuk az alábbi bemeneti fájlformátumot a programhoz:

<pre>
; komment, ami pontosvesszővel kezdődik, vagy üres sor

; a p-vel kezdődő sorok csúcsokat határoznak meg.
; az első szám a pont sorszáma, a többi három pedig az x,y,z koordináta (valós)
p 1 -100 100 -100
p 2 100 100 -100
p 3 100 -100 -100
p 4 -100 -100 -100

; az l-es sorok egy élt adnak meg. az első szám egy színkód (egész),
; a másik kettő pedig a két összekötendő pont
l 1 1 2
l 1 2 3
l 1 3 4
l 1 4 1

; az s-es sor egy szöveg, ami megjelenik a képen. 
; az első két szám a képernyőkoordináta, a harmadik a színkód.
; utána sor végéig a megjelenítendő szöveg.
s 10 10 1 Negyzet
</pre>

<p>Definiáljuk az alábbi adatszerkezetet! Legalapvetőbb építőkő a <code>Pont</code>.
Ez tárolja egy pont fájlból beolvasott, térbeli koordinátáit (x, y, z), és a sorszámát (hanyadik).
Ezen kívül eltárolja a forgatás során előálló új térbeli koordinátákat (xf, yf, zf), és a vetítéssel
kapott képernyőkoordinátákat (xk, yk). A láncolt lista építéséhez pedig egy pointert:

<pre   ><code class="language-c">typedef struct Pont {
    double x, y, z;     /* eredeti 3d koordináta */
    int hanyadik;       /* fájlbeli sorszám */

    double xf, yf, zf;  /* forgatott 3d koordináta */
    int xk, yk;         /* képernyőn koordináta */
    struct Pont *kov;
} Pont;</code></pre>

<p>Egy élt a <code>Vonal</code> nevű struktúrában tárolunk. Ez tárolja a két hivatkozott pont 
sorszámot, és tárol két pointert is a két összekötött pontra. Ezek közül elvileg csak az egyik 
párosra lenne szükség, de kényelmes, ha megvan mind a kettő. A fájl a sorszámokkal hivatkozik a 
pontokra, de a teljes bemenet beolvasása után a program minden élhez megkeresi a két összekötött 
pontot a pontok láncolt listájából, hogy ne kelljen újra és újra elvégezni ezt a műveletet. Mivel
a forgatás közben az nem változik, hogy melyik él mely csúcsokat köti össze, ezért ez megtehető:

<pre   ><code class="language-c">typedef struct Vonal {
    int pi1, pi2;   /* pontok indexe, amit osszekot */
    Pont *p1, *p2;  /* pointer rájuk, hogy ne kelljen mindig megkeresni */
    int szin;       /* színkód a fenti tömbből */
    struct Vonal *kov;
} Vonal;</code></pre>

<p>A feliratot tároló <code>Szoveg</code> struktúra sok magyarázatot nem igényel:

<pre   ><code class="language-c">typedef struct Szoveg {
    char felirat[100];  /* felirat szövege */
    int x, y, szin;     /* pozíció és szín */
    struct Szoveg *kov;
} Szoveg;</code></pre>

<p>Ahogyan a <code>Rajz</code> struktúra sem: egy rajz pontokból, azokat összekötő vonalakból
és feliratokból áll. A <code>latszik[]</code> tömb öt darab logikai értéket tárol: a rajzon
a különböző élek a programban ki-be kapcsolhatók. Ennek célja érthető lesz a program kipróbálásakor.

<pre   ><code class="language-c">typedef struct Rajz {
    Pont *pontok;
    Vonal *vonalak;
    Szoveg *szovegek;
    bool latszik[5];    /* melyik színű vonalak látszanak épp */
} Rajz;</code></pre>

  
    </div>

<div class="clear"></div>

</div>
</section>


<section class="slidescreen" data-title="A program működése">
<div class="slide" id="slide_4">

<a id="4" class="namer"></a>

<div class="slideheader">
  <h2 class="slidetitle">
    <span class="oldalszam">4</span><span class="oldalszamafter">. </span>    A program működése<a class="hlink" href="index.html@v=18.html#4"><i class="hlink"></i></a>
  </h2>
</div>

<div class="slidecontent">
  
<p>A fentiek után a program működése különösebb magyarázatot nem igényel. A függvények az alábbiak:
<ul>
    <li><code>bool beolvas(char const *fajlnev, Rajz *rajz)</code>: beolvassa a megadott nevű fájlt
        az addig inicializálatlan <code>Rajz</code> struktúrába. Hamissal tér vissza hiba esetén.
        (Ez a kód megmutatja, hogyan szokás használni az utasításblokkokat a változók láthatóságának
        korlátozására. Ezen kívül mutat egy-két <code>scanf()</code>-es trükköt.) Az adatok
        beolvasása után végigmegy a vonalak listáján, és mindegyik vonalnak megkeresi a két végpontját,
        hogy később már ne kelljen ezzel foglalkoznia a kirajzoló függvénynek.
    <li><code>void forgat_es_vetit(SDL_Surface *screen, Rajz *rajz, double szog, double d)</code>:
        ez a függvény végzi el a fent részletezett matematikai műveleteket, a három tengely körüli
        forgatást és a vetítési transzformációt. Az egyes pontok <code>xk</code>, <code>yk</code>
        adattagjait módosítja, amelyeket a
    <li><code>void kirajzol(SDL_Surface *screen, Rajz const *rajz)</code> függvény használ majd fel.
</ul>


<p>A program futása közben az 1, 2, 3, 4 gombokkal lehet ki- és bekapcsolni az egyes
éleket, szín szerint. A 0-s gomb az élek sorszámait kapcsolja ki-be (ez jól jön akkor,
amikor egy bemeneti fájlt vizsgálunk). A fel és le nyilakkal pedig közelebbről vagy
távolabbról lehet nézni a forgatott testet. d=200-nál közelebb nem lehet menni hozzá, mivel
akkor egyes pontok már a megfigyelő mögött lennének. Olyankor pedig <code>z&lt;0</code> miatt a vetítés
képlete hibás eredményt ad!

<p>Az <a href="advent18-drot.zip">advent18-drot.zip</a>-ben található néhány adatfájl is.
Ezekben az összes szabályos test szerepel, és
a szövegek megmutatják azt is, hogy mi közöttük a kapcsolat. A beolvasott adatfájl nevét a <code>main()</code>
függvény legelején lehet beállítani, vagy az első parancssori paraméterrel.

<p>Három ötlet a továbbfejlesztésre:

<ol>
    <li>Akinek van kék-piros vagy kék-sárga 3D szemüvege, megcsinálhatja,
    hogy minden képre kétszer rajzolja ki az éleket, egymáshoz képest kicsit eltolva vízszintesen a pontokat.

    <li>A távolabbi éleket halványabb színnel kirajzolva a 3D hatás erősíthető, hasonlóan, mint fent az ikozaéder
    képénél. (Ehhez az él színének megválasztásánál figyelembe kell venni a forgatás utáni <code>z</code> koordinátát.
    A szakaszokat fel kell bontani kis darabokra, mivel az SDL_gfx <code>lineColor()</code> függvénye csak konstans
    színnel tud rajzolni.)

    <li>Az élek tárolása helyett lapokat tárolni, vagyis azokat a sokszögeket, amelyek
    a poliédert határolják. A vonalak láncolt listája helyébe ilyenkor a lapok láncolt listája lép. Egy laphoz
    egy dinamikus tömb tartozhat, mivel a lapok csúcsszáma eltérő lehet – de a csúcsok ugyanígy egy pontra hivatkozásként
    jelenhetnek meg, mint most. A <a href="http://www.scienceu.com/geometry/facts/solids/">Science U</a> oldalán
    lehet olyan adatfájlokat találni, amelyekben a lapok adatai is szerepelnek. Az SDL_gfx <code>filledPolygonColor()</code>
    függvénye nem csak teljesen átlátszatlan (FF-re végződő), hanem félig átlátszó színeket is kaphat, így olyan testeket
    lehet rajzolni, amelyeket üveglapok építenek fel: mint például <a href="http://hu.wikipedia.org/wiki/Ikoza%C3%A9der">ezen</a> a Wikipedia oldalon.
</ol>

<p class="kicsinyit" style="margin-top: 2em;">A félszabályos testek koordinátái a <a href="http://www.scienceu.com/geometry/facts/solids/">Science U</a> oldalról származnak.</p>
  
    </div>

<div class="clear"></div>

</div>
</section>

</div>
</main>

<footer role="contentinfo">
<div class="shaper">
<div class="footer ">
  <a href="../index/index.html"><img src="../modulz/logo.png" class="footerlogo" alt="Logo"></a>
<div>InfoC – Programozás alapjai I.</div>
<div class="csakkepernyon">
            <a href="../index/index.html">főoldal</a>
         ·     <a href="../elerhetoseg/index.html">elérhetőség</a>
         ·     <a href="../elerhetoseg/index.html#licenc">licenc</a>
         ·     <a href="https://www.facebook.com/infoceetbmehu">facebook</a>
    </div>
<div class="csaknyomtatasban">Kérjük, az oldalak kinyomtatása előtt gondolj a környezetre.</div>
BME EET, 2009-2021.</div>
</div>
</footer>

</div>

<nav>
<a id="scrolltotop"></a>
</nav>

</body>

</html>
